var moduloForm=function(){var e={token:"meta[name='csrf-token']",urlAjax:$("body").data("url"),tableOrders:"#datatable",btnFilter:"#filter_btn",btnModalAddOrder:"#btn-modal-add-order",btnCloseModalOrder:".close-modal-order",btnCloseModalEditOrder:".close-modal-edit-order",btnManualEntry:"#btn-manual-entry",formLogsOrder:"#form-add-log-order",btnExportOrders:"#export_btn"};dom={};var a={datatable:function(){datatable=dom.tableOrders.DataTable({processing:!0,language:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{colvis:"Columnas",pageLength:"Mostrar"}},autoWidth:!1,columns:[{name:"id"},{name:"name"},{name:"lastname"},{name:"phone"},{name:"rut"},{name:"email"},{name:"region"},{name:"commune_string"},{name:"details"},{name:"campaign"},{name:"created_at"},{name:"estado",orderable:!1,searchable:!1}],order:[[10,"desc"]],serverSide:!0,responsive:!0,stateSave:!1,ajax:{url:dom.url+"/forms/datatable",type:"POST",data:function(e){e.filter_commune=$("#filter_commune").val(),e.filter_date=$("#filter_date").val(),e.filter_status=$("#filter_status").val(),e.filter_campaign=$("#filter_campaign").val()},complete:function(){}}}),dom.btnFilter.click((function(){datatable.ajax.reload()}))},loadDaterangepicker:function(){$('input[name="filter_date"]').daterangepicker({locale:{format:"YYYY-MM-DD",separator:" hasta ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Hasta",customRangeLabel:"Personalizado",weekLabel:"W",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1},startDate:moment().subtract(10,"days").format("YYYY-MM-DD"),endDate:moment().add(10,"days").format("YYYY-MM-DD")})},loadSelect2:function(){$('select[name="filter_user"]').select2()},modalAddOrder:function(){$("#modal-add-order").modal("show"),user_id=null,$.ajax({url:dom.url+"/admin/orders/create",type:"POST",data:{id:user_id},beforeSend:function(e,a){$("#modal-add-order #alert-danger").addClass("d-none"),$("#modal-add-order .overlay-modal").removeClass("d-none")},success:function(e){$("#modal-add-order .modal-body .data").html(e),$("select[name=region_id]").change(a.getCommunes),$("#select_examns").select2(),$("#select_examns").select2({placeholder:"Seleccione los exámenes"}).on("change",(function(e){ids=$(this).val(),a.calculatePriceExams(ids)})),a.uploadFile()},complete:function(e,a){setTimeout((function(){$("#modal-add-order .overlay-modal").addClass("d-none")}),1e3)},error:function(e,a,r){confirm("Error en la petición, recargar la página para volver a cargar los módulos")&&location.reload()}})},modelEditOrder:function(){$("#modal-edit-order").modal("show"),order_id=$(this).data("id"),$.ajax({url:dom.url+"/admin/orders/edit",type:"POST",data:{id:order_id},beforeSend:function(e,a){$("#modal-edit-order #alert-danger").addClass("d-none"),$("#modal-edit-order .overlay-modal").removeClass("d-none")},success:function(e){$("#modal-edit-order .modal-body .data").html(e),$("select[name=region_id]").change(a.getCommunes),$("#select_examns").select2();var r=$("#select_examns").select2({placeholder:"Seleccione los exámenes"});r.on("change",(function(e){ids=$(this).val(),a.calculatePriceExams(ids)})),r.trigger("change"),$('#modal-edit-order input[name="date"]').daterangepicker({locale:{format:"YYYY-MM-DD",separator:" hasta ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Hasta",customRangeLabel:"Personalizado",weekLabel:"W",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1},singleDatePicker:!0,minYear:parseInt(moment().format("YYYY"),10),maxYear:parseInt(moment().format("YYYY"),10)}),a.getDataLogs(order_id),$(".btn-update-order").on("click",a.updateOrder),a.uploadFile(order_id),a.uploadResultExamFile(order_id)},complete:function(e,a){setTimeout((function(){$("#modal-edit-order .overlay-modal").addClass("d-none")}),1e3)},error:function(e,a,r){confirm("Error en la petición, recargar la página para volver a cargar los módulos")&&location.reload()}})},closeModalOrder:function(){$("#modal-add-order .modal-body .data").html(""),$("#modal-add-order").modal("hide")},closeModalEditOrder:function(){$("#modal-edit-order .modal-body .data").html(""),$("#modal-edit-order").modal("hide")},submitManualEntry:function(){$.ajax({url:window.location.origin+"/admin/orders/storeManual",data:$("#form-manual-entry").serialize(),type:"POST",dataType:"json",beforeSend:function(e,a){$("#modal-add-order .alert-danger").addClass("d-none"),$("#modal-add-order .overlay-modal").removeClass("d-none"),$("#btn-manual-entry").attr("disabled",!1),$("#btn-manual-entry .spinner-border").removeClass("d-none")},success:function(e){$("#modal-add-order").modal("hide"),dom.btnFilter.trigger("click"),location.reload()},complete:function(e,a){setTimeout((function(){$("#btn-manual-entry").attr("disabled",!1),$("#btn-manual-entry .spinner-border").addClass("d-none"),$("#modal-add-order .overlay-modal").addClass("d-none")}),1e3)},error:function(e,a,r){422==e.status?($("#modal-add-order .alert-danger").removeClass("d-none"),response=e.responseJSON,html="<ul style='text-align:left;'>",$.each(response.errors,(function(e,a){html+="<li>"+a+"</li>"})),html+="</ul>",$("#modal-add-order .alert-danger").html(html)):confirm("Error en la petición, recargar la página para volver a cargar los módulos")&&location.reload()}})},updateOrder:function(e){e.preventDefault(),Swal.fire({title:"Actualizar",text:"¿Deseas actualizar los datos?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&(form=$(this).data("form"),$.ajax({url:window.location.origin+"/admin/orders/update",data:$("#"+form).serialize(),type:"POST",dataType:"json",beforeSend:function(e,a){$("#modal-edit-order .alert-danger").addClass("d-none"),$("#modal-edit-order .overlay-modal").removeClass("d-none"),$("#btn-update-order").attr("disabled",!1),$("#btn-update-order .spinner-border").removeClass("d-none")},success:function(e){0==e.id?(dom.btnFilter.trigger("click"),a.getDataLogs(e.id),Swal.fire("Error!",e.error,"error")):(dom.btnFilter.trigger("click"),a.getDataLogs(e.id),Swal.fire("Correcto!","","success"))},complete:function(e,a){setTimeout((function(){$("#btn-update-order").attr("disabled",!1),$("#btn-update-order .spinner-border").addClass("d-none"),$("#modal-edit-order .overlay-modal").addClass("d-none")}),1e3)},error:function(e,a,r){422==e.status?(response=e.responseJSON,html="<ul style='text-align:left;'>",$.each(response.errors,(function(e,a){html+="<li>"+a+"</li>"})),html+="</ul>",Swal.fire(html,"","error")):Swal.fire("Error al actualizar los datos","","error")}}))}))},exportDataOrders:function(){$.ajax({url:window.location.origin+"/forms/export",data:{filter_commune:$("#filter_commune").val(),filter_date:$("#filter_date").val(),filter_status:$("#filter_status").val(),filter_campaign:$("#filter_campaign").val()},type:"POST",dataType:"json",beforeSend:function(e,a){},success:function(e){window.location.replace(e.url)},complete:function(e,a){},error:function(e,a,r){confirm("Error en la petición, recargar la página para volver a cargar los módulos")&&location.reload()}})}};return{init:function(){dom.token=$(e.token).attr("content"),dom.url=e.urlAjax,dom.tableOrders=$(e.tableOrders),dom.btnFilter=$(e.btnFilter),dom.btnModalAddOrder=$(e.btnModalAddOrder),dom.btnCloseModalOrder=$(e.btnCloseModalOrder),dom.btnCloseModalEditOrder=$(e.btnCloseModalEditOrder),dom.btnManualEntry=$(e.btnManualEntry),dom.formLogsOrder=$(e.formLogsOrder),dom.btnExportOrders=$(e.btnExportOrders),$.ajaxSetup({headers:{"X-CSRF-Token":dom.token}}),a.loadDaterangepicker(),a.loadSelect2(),a.datatable(),dom.btnModalAddOrder.click(a.modalAddOrder),dom.btnCloseModalOrder.click(a.closeModalOrder),dom.btnCloseModalEditOrder.click(a.closeModalEditOrder),dom.btnManualEntry.click(a.submitManualEntry),dom.btnExportOrders.click(a.exportDataOrders)}}}();moduloForm.init();
